
#  Licensed to the Apache Software Foundation (ASF) under one or more
#  contributor license agreements.  See the NOTICE file distributed with
#  this work for additional information regarding copyright ownership.
#  The ASF licenses this file to You under the Apache License, Version 2.0
#  (the "License"); you may not use this file except in compliance with
#  the License.  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.

# no cahce for root index redirection
<If "%{REQUEST_URI} =~ m#^/?([\w\-]+\.html)?$#">
    <IfModule mod_expires.c>
        ExpiresActive off
    </IfModule>

    <IfModule mod_headers.c>
        Header always set Cache-Control "no-store, no-cache, must-revalidate"
        Header always set Expires "Thu, 01 Dec 1994 16:00:00 GMT"
        Header always merge Vary "Accept-Language"
    </IfModule>
</If>

<IfModule mod_rewrite.c>
  RewriteEngine On

  RewriteCond "%{HTTP:Accept-Language}" ^zh
  RewriteCond %{HTTP_HOST} !cn
  RewriteCond %{HTTP_HOST} !static
  RewriteRule ^(.*)$ https://cn.dubbo.apache.org/$1 [L,R=301]

  RewriteCond %{SERVER_PORT} !^443$
  RewriteCond %{HTTP_HOST} !static
  RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

  RewriteCond "%{HTTP:Accept-Language}" ^zh [NC]
  RewriteRule ^/?(index\.html)?$ "/zh-cn/index.html" [L,R=301]

  RewriteRule ^/?(index\.html)?$ "/en/index.html" [L,R=301]

  RewriteCond "%{HTTP:Accept-Language}" ^zh [NC]
  RewriteRule ^/?faq/?([\w\-/]+)?$ "/zh-cn/docs3-v2/java-sdk/faq/$1" [L,R=301]

  RewriteRule ^/?faq/?([\w\-/]+)?$ "/en/docs3-v2/java-sdk/faq/$1" [L,R=301]

  RewriteRule ^/?zh/([\s\S]*)?$ "/zh-cn/$1" [L,R=301]
</IfModule>
